<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <title>Esqueci minha senha</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- ...existing code... -->
  <link rel="stylesheet" href="/css/app.css">
</head>
<body>
  <div class="container">
    <div class="card card-form">
      <h2 class="card-title">Redefinir Senha</h2>
      <form id="reset-password-form" class="form">
        <div class="form-group">
          <label for="tipo-usuario">Tipo de usuário:</label>
          <select id="tipo-usuario" name="tipo-usuario" class="input" required>
            <option value="">Selecione</option>
            <option value="cliente">Cliente</option>
            <option value="barbeiro">Barbeiro</option>
          </select>
        </div>
        <div class="form-group">
          <label for="email">E-mail:</label>
          <input type="email" id="email" name="email" class="input" required autocomplete="email">
        </div>
        <div class="form-group">
          <label for="nova-senha">Nova senha:</label>
          <input type="password" id="nova-senha" name="nova-senha" class="input" required autocomplete="new-password">
        </div>
        <div class="form-group">
          <label for="confirmar-senha">Confirmar nova senha:</label>
          <input type="password" id="confirmar-senha" name="confirmar-senha" class="input" required autocomplete="new-password">
        </div>
        <button type="submit" class="btn btn-primary btn-block" id="btn-redefinir">Redefinir Senha</button>
      </form>
      <div id="mensagem" class="mensagem" aria-live="polite"></div>
      <div class="form-footer">
        <a href="/login.html" class="link">Voltar ao login</a>
      </div>
    </div>
  </div>
  <script>
    const form = document.getElementById('reset-password-form');
    const mensagem = document.getElementById('mensagem');
    const btnRedefinir = document.getElementById('btn-redefinir');

    // Limpa mensagem ao digitar
    form.querySelectorAll('input, select').forEach(el => {
      el.addEventListener('input', () => {
        mensagem.textContent = '';
      });
    });

    form.addEventListener('submit', async function(e) {
      e.preventDefault();
      btnRedefinir.disabled = true;
      const tipoUsuario = document.getElementById('tipo-usuario').value;
      const email = document.getElementById('email').value;
      const senha = document.getElementById('nova-senha').value;
      const confirmar = document.getElementById('confirmar-senha').value;
      mensagem.textContent = '';

      // Validação de campos obrigatórios
      if (!tipoUsuario || !email || !senha || !confirmar) {
        mensagem.textContent = 'Preencha todos os campos.';
        mensagem.style.color = 'red';
        btnRedefinir.disabled = false;
        return;
      }

      // Validação de senha mínima
      if (senha.length < 6) {
        mensagem.textContent = 'A senha deve ter pelo menos 6 caracteres.';
        mensagem.style.color = 'red';
        btnRedefinir.disabled = false;
        return;
      }

      if (senha !== confirmar) {
        mensagem.textContent = 'As senhas não coincidem.';
        mensagem.style.color = 'red';
        btnRedefinir.disabled = false;
        return;
      }
      try {
        const resposta = await fetch('/api/redefinir-senha', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            tipoUsuario,
            email,
            novaSenha: senha
          })
        });
        const resultado = await resposta.json();
        if (resposta.ok) {
          mensagem.textContent = resultado.mensagem || 'Senha redefinida com sucesso!';
          mensagem.style.color = 'green';
          form.reset();
        } else {
          mensagem.textContent = resultado.erro 
            ? `Erro ao redefinir senha: ${resultado.erro}` 
            : 'Erro ao redefinir senha. Por favor, verifique os dados informados e tente novamente.';
          mensagem.style.color = 'red';
        }
      } catch (err) {
        mensagem.textContent = 'Erro de conexão com o servidor.';
        mensagem.style.color = 'red';
      }
      btnRedefinir.disabled = false;
    });
  </script>
  <!-- ...existing code... -->
</body>
</html>